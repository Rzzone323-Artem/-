<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ - –ß–£–î–û-–ë–ê–ó–ê–† "–°–≤—è—Ç–æ–π –ê–ª—Ç–∞—Ä—å"</title>
<link rel="stylesheet" href="style.css">
<script src="audio-utils.js"></script>
<script src="sounds.js"></script>
<script src="google-sheets.js"></script>
<script src="simple-setup.js"></script>
<style>
body {
    background: #000;
    color: #0F0;
    font-family: "Courier New", monospace;
    padding: 20px;
}

.order-item {
    background: rgba(75, 0, 130, 0.1);
    border: 2px solid #4B0082;
    padding: 15px;
    margin: 10px 0;
    border-radius: 8px;
    position: relative;
}

.order-time {
    color: #FF0;
    font-size: 12px;
    margin-bottom: 5px;
}

.order-field {
    margin: 5px 0;
}

.order-field strong {
    color: #8a2be2;
}

.order-message {
    color: #C0C0C0;
    font-style: italic;
    margin-top: 10px;
    padding: 10px;
    background: rgba(0, 0, 0, 0.3);
    border-left: 3px solid #ff0066;
}

.delete-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #800;
    color: #FFF;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    border-radius: 3px;
}

.delete-btn:hover {
    background: #A00;
}

.admin-only {
    background: rgba(255, 0, 0, 0.1);
    border: 2px solid #F00;
    padding: 20px;
    margin: 20px 0;
    text-align: center;
    border-radius: 8px;
}

.clear-all-btn {
    background: linear-gradient(45deg, #800, #400);
    color: #FFF;
    border: 2px solid #F00;
    padding: 10px 20px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    margin: 10px;
    border-radius: 5px;
    text-transform: uppercase;
}

.clear-all-btn:hover {
    background: linear-gradient(45deg, #A00, #600);
    transform: scale(1.05);
}
</style>
</head>

<body>

<div class="admin-only">
<h2>üîê –ü–ê–ù–ï–õ–¨ –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê</h2>
<p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∞–π—Ç–∞</p>
<p>–í—Å–µ –∑–∞–∫–∞–∑—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∏–∂–µ</p>
<button class="clear-all-btn" onclick="clearAllOrders()">üóëÔ∏è –û–ß–ò–°–¢–ò–¢–¨ –ó–ê–ö–ê–ó–´</button>
<button class="clear-all-btn" onclick="clearAllMessages()">üóëÔ∏è –û–ß–ò–°–¢–ò–¢–¨ –°–û–û–ë–©–ï–ù–ò–Ø</button>
<button class="clear-all-btn" onclick="clearAll()">üóëÔ∏è –û–ß–ò–°–¢–ò–¢–¨ –í–°–Å</button>
</div>

<hr>

<h2>üì¶ –ó–ê–ö–ê–ó–´ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô</h2>

<div id="ordersList">
<p style="color: #FF0;">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</p>
</div>

<hr>

<h2>üí¨ –°–û–û–ë–©–ï–ù–ò–Ø –ù–ê –ú–û–î–ï–†–ê–¶–ò–Æ</h2>

<div id="messagesList">
<p style="color: #FF0;">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...</p>
</div>

<script>
// –§—É–Ω–∫—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
function safeCreateElement(tagName) {
    return document.createElement(tagName);
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –∏–∑ Google Sheets (–ø—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è)
async function loadOrders() {
    const ordersList = document.getElementById('ordersList');
    
    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    ordersList.innerHTML = '';
    const loadingPara = safeCreateElement('p');
    loadingPara.textContent = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...';
    loadingPara.style.color = '#FF0';
    ordersList.appendChild(loadingPara);
    
    try {
        const orders = await window.simpleSheets.getOrders();
        
        if (orders.length > 0) {
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∑–∞–∫–∞–∑–æ–≤
            ordersList.innerHTML = '';
            orders.forEach((order, index) => {
                const orderDiv = safeCreateElement('div');
                orderDiv.className = 'order-item';
                
                const timeDiv = safeCreateElement('div');
                timeDiv.className = 'order-time';
                timeDiv.textContent = `üìÖ ${order[0]}`;
                orderDiv.appendChild(timeDiv);
                
                const nameDiv = safeCreateElement('div');
                nameDiv.className = 'order-field';
                nameDiv.innerHTML = '<strong>üë§ –ò–º—è:</strong> ' + order[1];
                orderDiv.appendChild(nameDiv);
                
                const emailDiv = safeCreateElement('div');
                emailDiv.className = 'order-field';
                emailDiv.innerHTML = '<strong>üìß Email:</strong> ' + order[2];
                orderDiv.appendChild(emailDiv);
                
                const productDiv = safeCreateElement('div');
                productDiv.className = 'order-field';
                productDiv.innerHTML = '<strong>üì¶ –¢–æ–≤–∞—Ä:</strong> ' + order[3];
                orderDiv.appendChild(productDiv);
                
                const messageDiv = safeCreateElement('div');
                messageDiv.className = 'order-message';
                messageDiv.innerHTML = '<strong>üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ' + order[4];
                orderDiv.appendChild(messageDiv);
                
                const deleteBtn = safeCreateElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = '‚ùå';
                deleteBtn.onclick = () => deleteOrder(index);
                orderDiv.appendChild(deleteBtn);
                
                ordersList.appendChild(orderDiv);
            });
        } else {
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∑–∞–∫–∞–∑–æ–≤
            ordersList.innerHTML = '';
            const noOrdersPara = safeCreateElement('p');
            noOrdersPara.textContent = '–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç';
            noOrdersPara.style.color = '#FF0';
            ordersList.appendChild(noOrdersPara);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', error);
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage –∫–∞–∫ –±—ç–∫–∞–ø
        const orders = JSON.parse(localStorage.getItem('siteOrders') || '[]');
        if (orders.length > 0) {
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ localStorage
            ordersList.innerHTML = '';
            orders.forEach((order, index) => {
                const orderDiv = safeCreateElement('div');
                orderDiv.className = 'order-item';
                
                const deleteBtn = safeCreateElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = '‚ùå';
                deleteBtn.onclick = () => deleteOrder(index);
                orderDiv.appendChild(deleteBtn);
                
                const timeDiv = safeCreateElement('div');
                timeDiv.className = 'order-time';
                timeDiv.textContent = `üìÖ ${order.date}`;
                orderDiv.appendChild(timeDiv);
                
                const nameDiv = safeCreateElement('div');
                nameDiv.className = 'order-field';
                nameDiv.innerHTML = '<strong>üë§ –ò–º—è:</strong> ' + order.name;
                orderDiv.appendChild(nameDiv);
                
                const emailDiv = safeCreateElement('div');
                emailDiv.className = 'order-field';
                emailDiv.innerHTML = '<strong>üìß Email:</strong> ' + order.email;
                orderDiv.appendChild(emailDiv);
                
                const productDiv = safeCreateElement('div');
                productDiv.className = 'order-field';
                productDiv.innerHTML = '<strong>üì¶ –¢–æ–≤–∞—Ä:</strong> ' + order.product;
                orderDiv.appendChild(productDiv);
                
                const messageDiv = safeCreateElement('div');
                messageDiv.className = 'order-message';
                messageDiv.innerHTML = '<strong>üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ' + order.message;
                orderDiv.appendChild(messageDiv);
                
                ordersList.appendChild(orderDiv);
            });
        } else {
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∑–∞–∫–∞–∑–æ–≤
            ordersList.innerHTML = '';
            const noOrdersPara = safeCreateElement('p');
            noOrdersPara.textContent = '–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç';
            noOrdersPara.style.color = '#FF0';
            ordersList.appendChild(noOrdersPara);
        }
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é (–ø—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è)
async function loadMessages() {
    const messagesList = document.getElementById('messagesList');
    
    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    messagesList.innerHTML = '';
    const loadingPara = safeCreateElement('p');
    loadingPara.textContent = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...';
    loadingPara.style.color = '#FF0';
    messagesList.appendChild(loadingPara);
    
    try {
        const messages = await window.simpleSheets.getMessages();
        
        if (messages.length > 0) {
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
            messagesList.innerHTML = '';
            messages.forEach((message, index) => {
                const messageDiv = safeCreateElement('div');
                messageDiv.className = 'message-item';
                
                const approveBtn = safeCreateElement('button');
                approveBtn.className = 'approve-btn';
                approveBtn.textContent = '‚úÖ';
                approveBtn.onclick = () => approveMessage(index);
                messageDiv.appendChild(approveBtn);
                
                const deleteBtn = safeCreateElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = '‚ùå';
                deleteBtn.onclick = () => deleteMessage(index);
                messageDiv.appendChild(deleteBtn);
                
                const timeDiv = safeCreateElement('div');
                timeDiv.className = 'message-time';
                timeDiv.textContent = `üìÖ ${message[0]}`;
                messageDiv.appendChild(timeDiv);
                
                const authorDiv = safeCreateElement('div');
                authorDiv.className = 'message-field';
                authorDiv.innerHTML = '<strong>ÔøΩ –ê–≤—Ç–æ—Ä:</strong> ' + message[1];
                messageDiv.appendChild(authorDiv);
                
                const emailDiv = safeCreateElement('div');
                emailDiv.className = 'message-field';
                emailDiv.innerHTML = '<strong>ÔøΩ Email:</strong> ' + message[2];
                messageDiv.appendChild(emailDiv);
                
                const contentDiv = safeCreateElement('div');
                contentDiv.className = 'message-content';
                contentDiv.innerHTML = '<strong>üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ' + message[3];
                messageDiv.appendChild(contentDiv);
                
                messagesList.appendChild(messageDiv);
            });
        } else {
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
            messagesList.innerHTML = '';
            const noMessagesPara = safeCreateElement('p');
            noMessagesPara.textContent = '–°–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –Ω–µ—Ç';
            noMessagesPara.style.color = '#FF0';
            messagesList.appendChild(noMessagesPara);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:', error);
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage –∫–∞–∫ –±—ç–∫–∞–ø
        const messages = JSON.parse(localStorage.getItem('pendingMessages') || '[]');
        if (messages.length > 0) {
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ localStorage
            messagesList.innerHTML = '';
            messages.forEach((message, index) => {
                const messageDiv = safeCreateElement('div');
                messageDiv.className = 'message-item';
                
                const approveBtn = safeCreateElement('button');
                approveBtn.className = 'approve-btn';
                approveBtn.textContent = '‚úÖ';
                approveBtn.onclick = () => approveMessage(index);
                messageDiv.appendChild(approveBtn);
                
                const deleteBtn = safeCreateElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = '‚ùå';
                deleteBtn.onclick = () => deleteMessage(index);
                messageDiv.appendChild(deleteBtn);
                
                const timeDiv = safeCreateElement('div');
                timeDiv.className = 'message-time';
                timeDiv.textContent = `üìÖ ${message.date}`;
                messageDiv.appendChild(timeDiv);
                
                const authorDiv = safeCreateElement('div');
                authorDiv.className = 'message-field';
                authorDiv.innerHTML = '<strong>üë§ –ê–≤—Ç–æ—Ä:</strong> ' + message.author;
                messageDiv.appendChild(authorDiv);
                
                const emailDiv = safeCreateElement('div');
                emailDiv.className = 'message-field';
                emailDiv.innerHTML = '<strong>ÔøΩ Email:</strong> ' + message.email;
                messageDiv.appendChild(emailDiv);
                
                const contentDiv = safeCreateElement('div');
                contentDiv.className = 'message-content';
                contentDiv.innerHTML = '<strong>üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ' + message.content;
                messageDiv.appendChild(contentDiv);
                
                messagesList.appendChild(messageDiv);
            });
        } else {
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
            messagesList.innerHTML = '';
            const noMessagesPara = safeCreateElement('p');
            noMessagesPara.textContent = '–°–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –Ω–µ—Ç';
            noMessagesPara.style.color = '#FF0';
            messagesList.appendChild(noMessagesPara);
        }
    }
}

// –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
function deleteOrder(index) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑?')) {
        const orders = JSON.parse(localStorage.getItem('siteOrders') || '[]');
        orders.splice(index, 1);
        localStorage.setItem('siteOrders', JSON.stringify(orders));
        loadOrders();
    }
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
function deleteMessage(index) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ?')) {
        const messages = JSON.parse(localStorage.getItem('pendingMessages') || '[]');
        messages.splice(index, 1);
        localStorage.setItem('pendingMessages', JSON.stringify(messages));
        loadMessages();
    }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
    loadOrders();
    loadMessages();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    const updateTimer = window.audioManager?.addTimer(setInterval(() => {
        loadOrders();
        loadMessages();
    }, 30000));
});

// –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
function clearAllOrders() {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        localStorage.removeItem('siteOrders');
        loadOrders();
    }
}

// –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
function clearAllMessages() {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        localStorage.removeItem('pendingMessages');
        loadMessages();
    }
}

// –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ
function clearAll() {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –í–°–Å - –∑–∞–∫–∞–∑—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        localStorage.removeItem('siteOrders');
        localStorage.removeItem('pendingMessages');
        loadOrders();
        loadMessages();
    }
}

// –û–¥–æ–±—Ä–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
function approveMessage(index) {
    if (confirm('–û–¥–æ–±—Ä–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ?')) {
        const messages = JSON.parse(localStorage.getItem('pendingMessages') || '[]');
        const message = messages[index];
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã —Ñ–æ—Ä—É–º–∞
        const topics = JSON.parse(localStorage.getItem('forumTopics') || '[]');
        topics.push(message);
        localStorage.setItem('forumTopics', JSON.stringify(topics));
        
        // –£–¥–∞–ª—è–µ–º –∏–∑ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
        messages.splice(index, 1);
        localStorage.setItem('pendingMessages', JSON.stringify(messages));
        
        loadMessages();
        alert('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–æ –∏ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –Ω–∞ —Ñ–æ—Ä—É–º–µ!');
    }
}

// –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
function rejectMessage(index) {
    if (confirm('–û—Ç–∫–ª–æ–Ω–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ?')) {
        const messages = JSON.parse(localStorage.getItem('pendingMessages') || '[]');
        messages.splice(index, 1);
        localStorage.setItem('pendingMessages', JSON.stringify(messages));
        loadMessages();
        alert('‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ');
    }
}
</script>

</body>
</html>
